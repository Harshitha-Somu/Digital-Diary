<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Write Entry - Digital Diary</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/boxicons/2.1.4/css/boxicons.min.css">
    <style>
        * {
            font-family: "Poppins", sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: linear-gradient(to bottom, #2c3e50, #34495e);
            color: white;
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            transition: 0.3s;
        }
        /* Editor */
        .editor {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
        }
        .title {
            font-size: 1.8em;
            font-weight: bold;
            border: none;
            background: transparent;
            color: white;
            width: 100%;
            outline: none;
        }
        .date-info {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 10px;
        }
        .textarea {
            flex: 1;
            font-size: 1.2em;
            border: none;
            background: rgb(3, 3, 3);
            color: rgb(23, 20, 20);
            outline: none;
            resize: none;
            padding: 10px;
            border-radius: 5px;
        }
        /* Skins */
        .skins {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .skins button {
            padding: 10px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            transition: 0.2s;
        }

        .skins button:hover {
            opacity: 0.8;
        }

        .theme1 { background: linear-gradient(to right, #d78484, #a7484a); }
        .theme2 { background: linear-gradient(to right, #aadae7, #4dcaf3); }
        .theme3 { background: linear-gradient(to right, #cbb0e7, #e9588b); }
        .theme4 { background: linear-gradient(to right, #92eec3, #27bc9e); }
        .theme5 { background: linear-gradient(to right, #9f7de7, #7952ef); }
        .theme6 { background: linear-gradient(to right, #e377aa, #ec59be); }
        /* Footer Menu */
        .footer-menu {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: rgba(0, 0, 0, 0.5);
        }

        .footer-menu i {
            font-size: 1.8em;
            cursor: pointer;
            color: white;
            transition: 0.2s;
        }

        .footer-menu i:hover {
            transform: scale(1.1);
            color: #32CDD5;
        }

        /* Image Resize */
        .uploaded-image {
            max-width: 100%;
            height: auto;
            cursor: nwse-resize;
            margin-top: 10px;
        }

        /* Dark Mode */
        .dark-mode {
            background: black;
            color: white;
        }

        /* Alignment */
        .alignment-options {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .alignment-options button {
            padding: 5px 10px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            transition: 0.2s;
        }

        .alignment-options button:hover {
            background: #32CDD5;
            color: white;
        }

        /* Save Button */
        .save-button {
            background: #27ae60;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            margin: 10px auto;
            display: block;
        }
         /* Theme Options inside Moon */
         .theme-container {
            position: relative;
        }

        .theme-options {
            display: none;
            position: absolute;
            bottom: 40px;
            right: 10px;
            background: rgba(0, 0, 0, 0.9);
            border-radius: 5px;
            padding: 10px;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.3);
        }

        .theme-options button {
            display: block;
            width: 100%;
            padding: 5px 10px;
            border: none;
            cursor: pointer;
            background: transparent;
            color: white;
            text-align: left;
            transition: 0.2s;
        }

        .theme-options button:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        /* Images & Audio Inside Text Area */
        .textarea img, .textarea audio {
            max-width: 60%;
            display: block;
            margin: 10px auto;
            border-radius: 5px;
        }

        /* Default Border for Images */
        .textarea img {
            border: 2px solid white;
        }

        /* Apply Background to Audio */
        .textarea audio {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
        }
        .alignment-container {
    position: relative;
}

.alignment-options {
    display: none;
    position: absolute;
    bottom: 40px; /* Adjusted to position above the icon */
    left: -10px;
    background: rgba(0, 0, 0, 0.9);
    border-radius: 5px;
    padding: 10px;
    box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.3);
    z-index: 100;
}

.alignment-options button {
    display: block;
    width: 100%;
    padding: 5px 10px;
    border: none;
    cursor: pointer;
    background: transparent;
    color: white;
    text-align: left;
    transition: 0.2s;
}

.alignment-options button:hover {
    background: rgba(255, 255, 255, 0.2);
}
.stop-button {
    background: #e74c3c;
    color: white;
    padding: 10px 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    text-align: center;
    margin: 10px auto;
    display: block;
}

.stop-button:hover {
    background: #c0392b;
}
.textarea[contenteditable="true"]:empty:before {
    content: attr(placeholder);
    color: rgb(238, 233, 233);
    pointer-events: none;
    display: block; /* For Firefox */
}
.textarea img {
    max-width: 60%;
    height: auto;
    display: block;
    margin: 10px auto;
    border: 2px solid white;
    border-radius: 5px;
}





    </style>
</head>
<body>

    <!-- Writing Area -->
    <div class="editor">
        <input type="text" class="title" placeholder="Title">
        <div class="date-info" id="dateInfo"></div>

        <!--<textarea class="textarea" placeholder="Start writing..."></textarea>-->
        <!-- Change this in dd_entries.html -->
<!-- From: 
<textarea class="textarea" placeholder="Start writing..."></textarea>-->

<!-- To: -->
<div id="entryText" class="textarea" contenteditable="true" placeholder="Start writing..."></div>
        <!-- Image Upload -->
        <input type="file" id="imageInput" accept="image/*" style="display: none;" onchange="displayImage(event)">
        
    </div>

    <!-- Footer Menu -->
<div class="footer-menu">
    <i class='bx bx-plus' onclick="changeFontSize()"></i>
    <i class='bx bx-minus' onclick="changeSize()"></i>
    <i class='bx bx-list-ul' onclick="toggleList()"></i>
    <!-- Alignment Container -->
<div class="alignment-container">
    <i class='bx bx-align-left' onclick="toggleAlignmentMenu()"></i>
    <div class="alignment-options" id="alignmentOptions">
        <button onclick="changeAlignment('left')">Left</button>
        <button onclick="changeAlignment('center')">Center</button>
        <button onclick="changeAlignment('right')">Right</button>
        <button onclick="changeAlignment('justify')">Justify</button>
    </div>
</div>


    <i class='bx bx-time' onclick="insertTime()"></i>
    <i class='bx bx-image' onclick="document.getElementById('imageInput').click()"></i>
    <i class='bx bx-microphone' onclick="startRecording()"></i>
    
    <!-- Moon Icon with Dropdown -->
    <div class="theme-container">
        <i class='bx bx-moon' onclick="toggleThemeMenu()"></i>
        <div class="theme-options" id="themeOptions">
            <button class="theme1" onclick="changeTheme('#d78484', '#a7484a')">Theme 1</button>
            <button class="theme2" onclick="changeTheme('#aadae7', '#4dcaf3')">Theme 2</button>
            <button class="theme3" onclick="changeTheme('#cbb0e7', '#e9588b')">Theme 3</button>
            <button class="theme4" onclick="changeTheme(' #92eec3', '#27bc9e')">Theme 4</button>
            <button class="theme5" onclick="changeTheme('#9f7de7', '#7952ef')">Theme 5</button>
            <button class="theme6" onclick="changeTheme('#e377aa', '#ec59be')">Theme 6</button>
        </div>
    </div>
</div>
<button id="stopRecordingButton" class="stop-button" onclick="stopRecording()" style="display: none;">
    Stop Recording
</button>

 <!-- Save Button -->
 <button class="save-button" onclick="saveEntry()">Save Entry</button>
 
    <script>
        function toggleAlignmentMenu() {
            let menu = document.getElementById("alignmentOptions");
            menu.style.display = (menu.style.display === "block") ? "none" : "block";
        }

        function changeAlignment(alignment) {
            document.getElementById("entryText").style.textAlign = alignment;
            document.getElementById("alignmentOptions").style.display = "none";
        }
        function updateDateTime() {
    let now = new Date();

    let dateOptions = { weekday: "long", month: "long", day: "numeric" };
    let timeOptions = { hour: "2-digit", minute: "2-digit", hour12: true };

    let formattedDate = now.toLocaleDateString("en-US", dateOptions);
    let formattedTime = now.toLocaleTimeString("en-US", timeOptions);

    document.getElementById("dateInfo").textContent = `${formattedDate} - ${formattedTime}`;

}

// Update time every second (optional)
setInterval(updateDateTime, 1000);

// Call function on page load
updateDateTime();


function changeFontSize() {
    let textArea = document.getElementById("entryText"); // Changed from .textarea to match your ID
    let currentSize = window.getComputedStyle(textArea).fontSize;
    textArea.style.fontSize = (parseInt(currentSize) + 2) + "px";
    // Store the current font size in a data attribute for easy access
    textArea.dataset.currentFontSize = (parseInt(currentSize) + 2) + "px";
}

function changeSize() {
    let textArea = document.getElementById("entryText"); // Changed from .textarea to match your ID
    let currentSize = window.getComputedStyle(textArea).fontSize;
    const newSize = Math.max(8, parseInt(currentSize) - 2); // Prevent font size from going below 8px
    textArea.style.fontSize = newSize + "px";
    textArea.dataset.currentFontSize = newSize + "px";
}
        function toggleThemeMenu() {
    let menu = document.getElementById("themeOptions");
    let moonIcon = document.querySelector(".bx-moon"); // Get the moon icon

    if (menu.style.display === "block") {
        menu.style.display = "none";
    } else {
        menu.style.display = "block";

        // Adjust positioning inside the moon icon
        let iconRect = moonIcon.getBoundingClientRect();
        menu.style.bottom = "40px"; // Adjust based on your layout
        menu.style.right = "0px";   // Align to the right side of the moon icon
    }
}



function changeTheme(color1, color2) {
    document.body.style.background = `linear-gradient(to right, ${color1}, ${color2})`;

    let textArea = document.querySelector(".textarea");
    textArea.style.background = `linear-gradient(to right, ${color1}, ${color2})`;
    textArea.style.color = "white";

    let images = textArea.querySelectorAll("img");
    images.forEach(img => img.style.border = `3px solid ${color2}`);

    let audios = textArea.querySelectorAll("audio");
    audios.forEach(audio => audio.style.background = color1);

    // Hide the theme menu after selection
    document.getElementById("themeOptions").style.display = "none";

    // Save the selected theme in localStorage
    localStorage.setItem("selectedTheme", JSON.stringify({ color1, color2 }));
}

// Apply the saved theme when the page loads
document.addEventListener("DOMContentLoaded", function () {
    let savedTheme = JSON.parse(localStorage.getItem("selectedTheme"));
    if (savedTheme) {
        changeTheme(savedTheme.color1, savedTheme.color2);
    }
});




function toggleAlignmentMenu() {
    let menu = document.getElementById("alignmentOptions");
    let alignIcon = document.querySelector(".bx-align-left");

    if (menu.style.display === "block") {
        menu.style.display = "none";
    } else {
        menu.style.display = "block";

        // Adjust positioning
        let iconRect = alignIcon.getBoundingClientRect();
        menu.style.bottom = "40px";
        menu.style.left = "0px";
    }
}

function changeAlignment(alignment) {
    document.querySelector(".textarea").style.textAlign = alignment;
    document.getElementById("alignmentOptions").style.display = "none"; // Hide after selection
}

        

        /*function displayImage(event) {
    let file = event.target.files[0];
    if (file) {
        let reader = new FileReader();
        reader.onload = function (e) {
            let img = document.createElement("img");
            img.src = e.target.result;
            img.style.maxWidth = "25%";
            img.style.borderRadius = "5px";
            img.style.display = "block";
            img.style.margin = "10px auto";
            img.style.border = "2px solid white"; // Default for dark mode

            document.getElementById("entryText").appendChild(img);
        };
        reader.readAsDataURL(file);
    }
}
function displayImage(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const img = document.createElement("img");
            img.src = e.target.result;
            img.style.maxWidth = "100%";
            img.style.display = "block";
            img.style.margin = "10px auto";
            img.style.border = "2px solid white";
            
            // Append to the contenteditable div
            const entryText = document.getElementById("entryText");
            entryText.appendChild(img);
            
            // Focus back on the content area
            entryText.focus();
        };
        reader.readAsDataURL(file);
    }
}*/

       

       
        

 

/*function saveEntry() {
    let title = document.querySelector(".title").value.trim();
    let content = document.querySelector(".textarea").innerHTML; // Preserve images/audio

    let entries = JSON.parse(localStorage.getItem("entries")) || [];
    entries.push({ title, content });

    localStorage.setItem("entries", JSON.stringify(entries));
    alert("Entry saved successfully!");
    window.location.href = "dd_saved_entries.html";
}*/

/*function saveEntry() {
    let title = document.querySelector(".title").value.trim();
    let content = document.getElementById("entryText").innerHTML; // Get HTML content

    let entries = JSON.parse(localStorage.getItem("entries")) || [];
    entries.push({ title, content });

    localStorage.setItem("entries", JSON.stringify(entries));
    alert("Entry saved successfully!");
    window.location.href = "dd_saved_entries.html";
}*/
function saveEntry() {
    const title = document.querySelector(".title").value.trim();
    const content = document.getElementById("entryText").innerHTML;
    
    const entries = JSON.parse(localStorage.getItem("entries")) || [];
    entries.push({ title, content });
    
    localStorage.setItem("entries", JSON.stringify(entries));
    alert("Entry saved successfully!");
    window.location.href = "dd_saved_entries.html";
}
function saveEntry() {
    let title = document.querySelector(".title").value.trim();
    let contentDiv = document.getElementById("entryText");
    
    // Get the computed alignment style
    let alignment = window.getComputedStyle(contentDiv).textAlign;
    
    let entries = JSON.parse(localStorage.getItem("entries")) || [];
    entries.push({ 
        title, 
        content: contentDiv.innerHTML,
        alignment: alignment  // Save the alignment with the entry
    });
    
    localStorage.setItem("entries", JSON.stringify(entries));
    alert("Entry saved successfully!");
    window.location.href = "dd_saved_entries.html";
}

        // Toggle Bullet List
        function toggleList() {
            let textArea = document.querySelector(".textarea");
            textArea.innerHTML += "<br>• ";
        }

        // Add Checkbox
        function addCheckbox() {
            let textArea = document.querySelector(".textarea");
            textArea.value += "\n[ ] ";
        }

        // Insert Current Time
        function insertTime() {
            let textArea = document.querySelector(".textarea");
            let now = new Date().toLocaleTimeString();
            textArea.innerHTML += "<br>" + now;
        }

        // Change Text Alignment
        function changeAlignment(alignment) {
            document.querySelector(".textarea").style.textAlign = alignment;
        }

        // Display and Resize Image
        function displayImage(event) {
            let file = event.target.files[0];
            if (file) {
                let reader = new FileReader();
                reader.onload = function (e) {
                    let img = document.createElement("img");
                    img.src = e.target.result;
                    img.classList.add("uploaded-image");
                    img.style.width = "100%";
                    img.style.maxWidth = "500px";
                    img.draggable = true;
                    img.onmousedown = function(event) {
                        document.onmousemove = function(e) {
                            img.style.width = e.clientX - img.offsetLeft + "px";
                        };
                        document.onmouseup = function() {
                            document.onmousemove = null;
                        };
                    };
                    document.querySelector(".editor").appendChild(img);
                };
                reader.readAsDataURL(file);
            }
        }
        <!-- In the body section, keep your existing structure but update the displayImage function -->

function displayImage(event) {
    let file = event.target.files[0];
    if (file) {
        let reader = new FileReader();
        reader.onload = function (e) {
            let img = document.createElement("img");
            img.src = e.target.result;
            img.style.maxWidth = "100%";
            img.style.borderRadius = "5px";
            img.style.display = "block";
            img.style.margin = "10px auto";
            img.style.border = "2px solid white";

            // Append to the contenteditable div
            document.getElementById("entryText").appendChild(img);
        };
        reader.readAsDataURL(file);
    }
}
/*function displayImage(event) {
    let file = event.target.files[0];
    if (file) {
        let reader = new FileReader();
        reader.onload = function(e) {
            let img = document.createElement("img");
            img.src = e.target.result;
            img.style.maxWidth = "100%";
            img.style.display = "block";
            img.style.margin = "10px auto";
            img.style.border = "2px solid white";
            
            document.getElementById("entryText").appendChild(img);
            makeImagesResizable(); // Make the new image resizable
        };
        reader.readAsDataURL(file);
    }
}
*/

        let mediaRecorder;
let audioChunks = [];

function startRecording() {
    navigator.mediaDevices.getUserMedia({ audio: true })
        .then(stream => {
            mediaRecorder = new MediaRecorder(stream);
            audioChunks = [];

            mediaRecorder.ondataavailable = event => {
                audioChunks.push(event.data);
            };

            mediaRecorder.onstop = async () => {
                let blob = new Blob(audioChunks, { type: 'audio/webm' });

                // Convert to Base64
                let reader = new FileReader();
                reader.readAsDataURL(blob);
                reader.onloadend = function () {
                    let audioBase64 = reader.result;

                    // Create audio element
                    let audio = document.createElement("audio");
                    audio.src = audioBase64;
                    audio.controls = true;
                    audio.style.display = "block";
                    audio.style.margin = "10px auto";

                    // Append to the textarea instead of editContent
                    document.querySelector(".textarea").appendChild(audio);

                    // Save to localStorage
                    let savedEntries = JSON.parse(localStorage.getItem("entries")) || [];
                    let index = localStorage.getItem("editEntryIndex");

                    if (index !== null && savedEntries[index]) {
                        savedEntries[index].audio = audioBase64;
                        localStorage.setItem("entries", JSON.stringify(savedEntries));
                    }
                };

                // Hide stop button after stopping
                document.getElementById("stopRecordingButton").style.display = "none";
            };

            mediaRecorder.start();

            // Show stop button
            document.getElementById("stopRecordingButton").style.display = "block";

            alert("Recording started. Click 'Stop Recording' to finish.");
        })
        .catch(error => alert("Microphone access denied. Check permissions."));
}



function stopRecording() {
    if (mediaRecorder) {
        mediaRecorder.stop();
        alert("Recording stopped.");

        // Hide stop button after stopping
        document.getElementById("stopRecordingButton").style.display = "none";
    }
}


        // Toggle Light/Dark Mode
        function toggleTheme() {
            document.body.classList.toggle("light-mode");
        }
        function makeImageResizable(img) {
    img.style.resize = "both";
    img.style.overflow = "auto";
    img.style.cursor = "nwse-resize";

    img.addEventListener("mousedown", function (e) {
        e.preventDefault();
        let startX = e.clientX;
        let startY = e.clientY;
        let startWidth = img.offsetWidth;
        let startHeight = img.offsetHeight;

        function resizeImage(e) {
            img.style.width = startWidth + (e.clientX - startX) + "px";
            img.style.height = startHeight + (e.clientY - startY) + "px";
        }

        function stopResize() {
            document.removeEventListener("mousemove", resizeImage);
            document.removeEventListener("mouseup", stopResize);
        }

        document.addEventListener("mousemove", resizeImage);
        document.addEventListener("mouseup", stopResize);
    });
}
function makeImagesResizable() {
    const entryText = document.getElementById('entryText');
    const images = entryText.querySelectorAll('img');
    
    images.forEach(img => {
        // Make sure image is resizable
        img.style.resize = 'both';
        img.style.overflow = 'auto';
        img.style.cursor = 'nwse-resize';
        img.draggable = false; // Prevent default drag behavior
        
        // Add resize handles
        const resizeHandle = document.createElement('div');
        resizeHandle.style.width = '10px';
        resizeHandle.style.height = '10px';
        resizeHandle.style.background = '#32CDD5';
        resizeHandle.style.position = 'absolute';
        resizeHandle.style.right = '0';
        resizeHandle.style.bottom = '0';
        resizeHandle.style.cursor = 'nwse-resize';
        
        img.style.position = 'relative';
        img.appendChild(resizeHandle);
        
        // Resize functionality
        resizeHandle.addEventListener('mousedown', initResize);
        
        function initResize(e) {
            e.preventDefault();
            window.addEventListener('mousemove', resize);
            window.addEventListener('mouseup', stopResize);
            
            const startX = e.clientX;
            const startY = e.clientY;
            const startWidth = parseInt(document.defaultView.getComputedStyle(img).width, 10);
            const startHeight = parseInt(document.defaultView.getComputedStyle(img).height, 10);
            
            function resize(e) {
                img.style.width = (startWidth + e.clientX - startX) + 'px';
                img.style.height = (startHeight + e.clientY - startY) + 'px';
            }
            
            function stopResize() {
                window.removeEventListener('mousemove', resize);
                window.removeEventListener('mouseup', stopResize);
            }
        }
    });
}
document.addEventListener('DOMContentLoaded', function() {
    makeImagesResizable();
});

function saveEntry() {
    const title = document.querySelector(".title").value.trim();
    const contentDiv = document.getElementById("entryText");
    const content = contentDiv.innerHTML;
    
    // Get all styles
    const alignment = window.getComputedStyle(contentDiv).textAlign;
    const fontSize = contentDiv.dataset.currentFontSize || window.getComputedStyle(contentDiv).fontSize;
    
    // Get current date
    const now = new Date();
    const dateISO = now.toISOString().split('T')[0];
    
    let entries = JSON.parse(localStorage.getItem("entries")) || [];
    entries.push({ 
        title, 
        content,
        alignment,
        fontSize,  // Now properly saving font size
        date: now.toISOString(),
        dateISO: dateISO
    });
    
    localStorage.setItem("entries", JSON.stringify(entries));
    alert("Entry saved successfully!");
    window.location.href = "dd_index.html";
}

    </script>

</body>
</html>